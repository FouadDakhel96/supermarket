{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) {\n    if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  }\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Autowired, Constants, PopupComponent, RefSelector, _, VirtualList } from \"@ag-grid-community/core\";\nimport { RichSelectRow } from \"./richSelectRow\";\n\nvar RichSelectCellEditor =\n/** @class */\nfunction (_super) {\n  __extends(RichSelectCellEditor, _super);\n\n  function RichSelectCellEditor() {\n    var _this = _super.call(this, RichSelectCellEditor.TEMPLATE) || this;\n\n    _this.selectionConfirmed = false;\n    _this.searchString = '';\n    return _this;\n  }\n\n  RichSelectCellEditor.prototype.init = function (params) {\n    this.params = params;\n    this.selectedValue = params.value;\n    this.originalSelectedValue = params.value;\n    this.focusAfterAttached = params.cellStartedEdit;\n\n    var icon = _.createIconNoSpan('smallDown', this.gridOptionsWrapper);\n\n    _.addCssClass(icon, 'ag-rich-select-value-icon');\n\n    this.eValue.appendChild(icon);\n    this.virtualList = new VirtualList('rich-select');\n    this.getContext().createBean(this.virtualList);\n    this.virtualList.setComponentCreator(this.createRowComponent.bind(this));\n    this.eList.appendChild(this.virtualList.getGui());\n\n    if (_.exists(this.params.cellHeight)) {\n      this.virtualList.setRowHeight(this.params.cellHeight);\n    }\n\n    this.renderSelectedValue();\n\n    if (_.missing(params.values)) {\n      console.warn('ag-Grid: richSelectCellEditor requires values for it to work');\n      return;\n    }\n\n    var values = params.values;\n    this.virtualList.setModel({\n      getRowCount: function getRowCount() {\n        return values.length;\n      },\n      getRow: function getRow(index) {\n        return values[index];\n      }\n    });\n    this.addGuiEventListener('keydown', this.onKeyDown.bind(this));\n    var virtualListGui = this.virtualList.getGui();\n    this.addManagedListener(virtualListGui, 'click', this.onClick.bind(this));\n    this.addManagedListener(virtualListGui, 'mousemove', this.onMouseMove.bind(this));\n    this.clearSearchString = _.debounce(this.clearSearchString, 300);\n\n    if (_.exists(params.charPress)) {\n      this.searchText(params.charPress);\n    }\n  };\n\n  RichSelectCellEditor.prototype.onKeyDown = function (event) {\n    var key = event.which || event.keyCode;\n\n    switch (key) {\n      case Constants.KEY_ENTER:\n        this.onEnterKeyDown();\n        break;\n\n      case Constants.KEY_DOWN:\n      case Constants.KEY_UP:\n        this.onNavigationKeyPressed(event, key);\n        break;\n\n      default:\n        this.searchText(event);\n    }\n  };\n\n  RichSelectCellEditor.prototype.onEnterKeyDown = function () {\n    this.selectionConfirmed = true;\n    this.params.stopEditing();\n  };\n\n  RichSelectCellEditor.prototype.onNavigationKeyPressed = function (event, key) {\n    // if we don't preventDefault the page body and/or grid scroll will move.\n    event.preventDefault();\n    var oldIndex = this.params.values.indexOf(this.selectedValue);\n    var newIndex = key === Constants.KEY_UP ? oldIndex - 1 : oldIndex + 1;\n\n    if (newIndex >= 0 && newIndex < this.params.values.length) {\n      var valueToSelect = this.params.values[newIndex];\n      this.setSelectedValue(valueToSelect);\n    }\n  };\n\n  RichSelectCellEditor.prototype.searchText = function (key) {\n    if (typeof key !== 'string') {\n      if (!_.isCharacterKey(key)) {\n        return;\n      }\n\n      key = key.key;\n    }\n\n    this.searchString += key;\n    this.runSearch();\n    this.clearSearchString();\n  };\n\n  RichSelectCellEditor.prototype.runSearch = function () {\n    var values = this.params.values;\n    var searchStrings;\n\n    if (typeof values[0] === \"number\" || typeof values[0] === \"string\") {\n      searchStrings = values.map(String);\n    }\n\n    if (typeof values[0] === \"object\" && this.params.colDef.keyCreator) {\n      searchStrings = values.map(this.params.colDef.keyCreator);\n    }\n\n    if (!searchStrings) {\n      return;\n    }\n\n    var topSuggestion = _.fuzzySuggestions(this.searchString, searchStrings, true, true)[0];\n\n    if (!topSuggestion) {\n      return;\n    }\n\n    var topSuggestionIndex = searchStrings.indexOf(topSuggestion);\n    var topValue = values[topSuggestionIndex];\n    this.setSelectedValue(topValue);\n  };\n\n  RichSelectCellEditor.prototype.clearSearchString = function () {\n    this.searchString = '';\n  };\n\n  RichSelectCellEditor.prototype.renderSelectedValue = function () {\n    var _this = this;\n\n    var valueFormatted = this.params.formatValue(this.selectedValue);\n    var eValue = this.eValue;\n    var params = {\n      value: this.selectedValue,\n      valueFormatted: valueFormatted,\n      api: this.gridOptionsWrapper.getApi()\n    };\n    var promise = this.userComponentFactory.newCellRenderer(this.params, params);\n\n    if (promise != null) {\n      _.bindCellRendererToHtmlElement(promise, eValue);\n    } else {\n      eValue.innerText = params.valueFormatted != null ? params.valueFormatted : params.value;\n    }\n\n    if (promise) {\n      promise.then(function (renderer) {\n        _this.addDestroyFunc(function () {\n          return _this.getContext().destroyBean(renderer);\n        });\n      });\n    } else {\n      if (_.exists(this.selectedValue)) {\n        eValue.innerHTML = valueFormatted;\n      } else {\n        _.clearElement(eValue);\n      }\n    }\n  };\n\n  RichSelectCellEditor.prototype.setSelectedValue = function (value) {\n    if (this.selectedValue === value) {\n      return;\n    }\n\n    var index = this.params.values.indexOf(value);\n\n    if (index >= 0) {\n      this.selectedValue = value;\n      this.virtualList.ensureIndexVisible(index);\n      this.virtualList.refresh();\n    }\n  };\n\n  RichSelectCellEditor.prototype.createRowComponent = function (value) {\n    var valueFormatted = this.params.formatValue(value);\n    var row = new RichSelectRow(this.params);\n    this.getContext().createBean(row);\n    row.setState(value, valueFormatted, value === this.selectedValue);\n    return row;\n  };\n\n  RichSelectCellEditor.prototype.onMouseMove = function (mouseEvent) {\n    var rect = this.virtualList.getGui().getBoundingClientRect();\n    var scrollTop = this.virtualList.getScrollTop();\n    var mouseY = mouseEvent.clientY - rect.top + scrollTop;\n    var row = Math.floor(mouseY / this.virtualList.getRowHeight());\n    var value = this.params.values[row]; // not using utils.exist() as want empty string test to pass\n\n    if (value !== undefined) {\n      this.setSelectedValue(value);\n    }\n  };\n\n  RichSelectCellEditor.prototype.onClick = function () {\n    this.selectionConfirmed = true;\n    this.params.stopEditing();\n  }; // we need to have the gui attached before we can draw the virtual rows, as the\n  // virtual row logic needs info about the gui state\n\n\n  RichSelectCellEditor.prototype.afterGuiAttached = function () {\n    var selectedIndex = this.params.values.indexOf(this.selectedValue); // we have to call this here to get the list to have the right height, ie\n    // otherwise it would not have scrolls yet and ensureIndexVisible would do nothing\n\n    this.virtualList.refresh();\n\n    if (selectedIndex >= 0) {\n      this.virtualList.ensureIndexVisible(selectedIndex);\n    } // we call refresh again, as the list could of moved, and we need to render the new rows\n\n\n    this.virtualList.refresh();\n\n    if (this.focusAfterAttached) {\n      this.getGui().focus();\n    }\n  };\n\n  RichSelectCellEditor.prototype.getValue = function () {\n    // NOTE: we don't use valueParser for Set Filter. The user should provide values that are to be\n    // set into the data. valueParser only really makese sense when the user is typing in text (not picking\n    // form a set).\n    return this.selectionConfirmed ? this.selectedValue : this.originalSelectedValue;\n  }; // tab index is needed so we can focus, which is needed for keyboard events\n\n\n  RichSelectCellEditor.TEMPLATE = \"<div class=\\\"ag-rich-select\\\" tabindex=\\\"-1\\\">\\n            <div ref=\\\"eValue\\\" class=\\\"ag-rich-select-value\\\"></div>\\n            <div ref=\\\"eList\\\" class=\\\"ag-rich-select-list\\\"></div>\\n        </div>\";\n\n  __decorate([Autowired('userComponentFactory')], RichSelectCellEditor.prototype, \"userComponentFactory\", void 0);\n\n  __decorate([Autowired('gridOptionsWrapper')], RichSelectCellEditor.prototype, \"gridOptionsWrapper\", void 0);\n\n  __decorate([RefSelector('eValue')], RichSelectCellEditor.prototype, \"eValue\", void 0);\n\n  __decorate([RefSelector('eList')], RichSelectCellEditor.prototype, \"eList\", void 0);\n\n  return RichSelectCellEditor;\n}(PopupComponent);\n\nexport { RichSelectCellEditor };","map":{"version":3,"sources":["/Users/fouaddakhel/Projects/Nana/ReactJS/supermarket_dashboard/supermarket_dashboard/node_modules/@ag-grid-enterprise/rich-select/dist/es6/richSelect/richSelectCellEditor.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","__decorate","decorators","target","key","desc","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","Autowired","Constants","PopupComponent","RefSelector","_","VirtualList","RichSelectRow","RichSelectCellEditor","_super","_this","call","TEMPLATE","selectionConfirmed","searchString","init","params","selectedValue","value","originalSelectedValue","focusAfterAttached","cellStartedEdit","icon","createIconNoSpan","gridOptionsWrapper","addCssClass","eValue","appendChild","virtualList","getContext","createBean","setComponentCreator","createRowComponent","bind","eList","getGui","exists","cellHeight","setRowHeight","renderSelectedValue","missing","values","console","warn","setModel","getRowCount","getRow","index","addGuiEventListener","onKeyDown","virtualListGui","addManagedListener","onClick","onMouseMove","clearSearchString","debounce","charPress","searchText","event","which","keyCode","KEY_ENTER","onEnterKeyDown","KEY_DOWN","KEY_UP","onNavigationKeyPressed","stopEditing","preventDefault","oldIndex","indexOf","newIndex","valueToSelect","setSelectedValue","isCharacterKey","runSearch","searchStrings","map","String","colDef","keyCreator","topSuggestion","fuzzySuggestions","topSuggestionIndex","topValue","valueFormatted","formatValue","api","getApi","promise","userComponentFactory","newCellRenderer","bindCellRendererToHtmlElement","innerText","then","renderer","addDestroyFunc","destroyBean","innerHTML","clearElement","ensureIndexVisible","refresh","row","setState","mouseEvent","rect","getBoundingClientRect","scrollTop","getScrollTop","mouseY","clientY","top","Math","floor","getRowHeight","undefined","afterGuiAttached","selectedIndex","focus","getValue"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Autowired, Constants, PopupComponent, RefSelector, _, VirtualList } from \"@ag-grid-community/core\";\nimport { RichSelectRow } from \"./richSelectRow\";\nvar RichSelectCellEditor = /** @class */ (function (_super) {\n    __extends(RichSelectCellEditor, _super);\n    function RichSelectCellEditor() {\n        var _this = _super.call(this, RichSelectCellEditor.TEMPLATE) || this;\n        _this.selectionConfirmed = false;\n        _this.searchString = '';\n        return _this;\n    }\n    RichSelectCellEditor.prototype.init = function (params) {\n        this.params = params;\n        this.selectedValue = params.value;\n        this.originalSelectedValue = params.value;\n        this.focusAfterAttached = params.cellStartedEdit;\n        var icon = _.createIconNoSpan('smallDown', this.gridOptionsWrapper);\n        _.addCssClass(icon, 'ag-rich-select-value-icon');\n        this.eValue.appendChild(icon);\n        this.virtualList = new VirtualList('rich-select');\n        this.getContext().createBean(this.virtualList);\n        this.virtualList.setComponentCreator(this.createRowComponent.bind(this));\n        this.eList.appendChild(this.virtualList.getGui());\n        if (_.exists(this.params.cellHeight)) {\n            this.virtualList.setRowHeight(this.params.cellHeight);\n        }\n        this.renderSelectedValue();\n        if (_.missing(params.values)) {\n            console.warn('ag-Grid: richSelectCellEditor requires values for it to work');\n            return;\n        }\n        var values = params.values;\n        this.virtualList.setModel({\n            getRowCount: function () { return values.length; },\n            getRow: function (index) { return values[index]; }\n        });\n        this.addGuiEventListener('keydown', this.onKeyDown.bind(this));\n        var virtualListGui = this.virtualList.getGui();\n        this.addManagedListener(virtualListGui, 'click', this.onClick.bind(this));\n        this.addManagedListener(virtualListGui, 'mousemove', this.onMouseMove.bind(this));\n        this.clearSearchString = _.debounce(this.clearSearchString, 300);\n        if (_.exists(params.charPress)) {\n            this.searchText(params.charPress);\n        }\n    };\n    RichSelectCellEditor.prototype.onKeyDown = function (event) {\n        var key = event.which || event.keyCode;\n        switch (key) {\n            case Constants.KEY_ENTER:\n                this.onEnterKeyDown();\n                break;\n            case Constants.KEY_DOWN:\n            case Constants.KEY_UP:\n                this.onNavigationKeyPressed(event, key);\n                break;\n            default:\n                this.searchText(event);\n        }\n    };\n    RichSelectCellEditor.prototype.onEnterKeyDown = function () {\n        this.selectionConfirmed = true;\n        this.params.stopEditing();\n    };\n    RichSelectCellEditor.prototype.onNavigationKeyPressed = function (event, key) {\n        // if we don't preventDefault the page body and/or grid scroll will move.\n        event.preventDefault();\n        var oldIndex = this.params.values.indexOf(this.selectedValue);\n        var newIndex = key === Constants.KEY_UP ? oldIndex - 1 : oldIndex + 1;\n        if (newIndex >= 0 && newIndex < this.params.values.length) {\n            var valueToSelect = this.params.values[newIndex];\n            this.setSelectedValue(valueToSelect);\n        }\n    };\n    RichSelectCellEditor.prototype.searchText = function (key) {\n        if (typeof key !== 'string') {\n            if (!_.isCharacterKey(key)) {\n                return;\n            }\n            key = key.key;\n        }\n        this.searchString += key;\n        this.runSearch();\n        this.clearSearchString();\n    };\n    RichSelectCellEditor.prototype.runSearch = function () {\n        var values = this.params.values;\n        var searchStrings;\n        if (typeof values[0] === \"number\" || typeof values[0] === \"string\") {\n            searchStrings = values.map(String);\n        }\n        if (typeof values[0] === \"object\" && this.params.colDef.keyCreator) {\n            searchStrings = values.map(this.params.colDef.keyCreator);\n        }\n        if (!searchStrings) {\n            return;\n        }\n        var topSuggestion = _.fuzzySuggestions(this.searchString, searchStrings, true, true)[0];\n        if (!topSuggestion) {\n            return;\n        }\n        var topSuggestionIndex = searchStrings.indexOf(topSuggestion);\n        var topValue = values[topSuggestionIndex];\n        this.setSelectedValue(topValue);\n    };\n    RichSelectCellEditor.prototype.clearSearchString = function () {\n        this.searchString = '';\n    };\n    RichSelectCellEditor.prototype.renderSelectedValue = function () {\n        var _this = this;\n        var valueFormatted = this.params.formatValue(this.selectedValue);\n        var eValue = this.eValue;\n        var params = {\n            value: this.selectedValue,\n            valueFormatted: valueFormatted,\n            api: this.gridOptionsWrapper.getApi()\n        };\n        var promise = this.userComponentFactory.newCellRenderer(this.params, params);\n        if (promise != null) {\n            _.bindCellRendererToHtmlElement(promise, eValue);\n        }\n        else {\n            eValue.innerText = params.valueFormatted != null ? params.valueFormatted : params.value;\n        }\n        if (promise) {\n            promise.then(function (renderer) {\n                _this.addDestroyFunc(function () { return _this.getContext().destroyBean(renderer); });\n            });\n        }\n        else {\n            if (_.exists(this.selectedValue)) {\n                eValue.innerHTML = valueFormatted;\n            }\n            else {\n                _.clearElement(eValue);\n            }\n        }\n    };\n    RichSelectCellEditor.prototype.setSelectedValue = function (value) {\n        if (this.selectedValue === value) {\n            return;\n        }\n        var index = this.params.values.indexOf(value);\n        if (index >= 0) {\n            this.selectedValue = value;\n            this.virtualList.ensureIndexVisible(index);\n            this.virtualList.refresh();\n        }\n    };\n    RichSelectCellEditor.prototype.createRowComponent = function (value) {\n        var valueFormatted = this.params.formatValue(value);\n        var row = new RichSelectRow(this.params);\n        this.getContext().createBean(row);\n        row.setState(value, valueFormatted, value === this.selectedValue);\n        return row;\n    };\n    RichSelectCellEditor.prototype.onMouseMove = function (mouseEvent) {\n        var rect = this.virtualList.getGui().getBoundingClientRect();\n        var scrollTop = this.virtualList.getScrollTop();\n        var mouseY = mouseEvent.clientY - rect.top + scrollTop;\n        var row = Math.floor(mouseY / this.virtualList.getRowHeight());\n        var value = this.params.values[row];\n        // not using utils.exist() as want empty string test to pass\n        if (value !== undefined) {\n            this.setSelectedValue(value);\n        }\n    };\n    RichSelectCellEditor.prototype.onClick = function () {\n        this.selectionConfirmed = true;\n        this.params.stopEditing();\n    };\n    // we need to have the gui attached before we can draw the virtual rows, as the\n    // virtual row logic needs info about the gui state\n    RichSelectCellEditor.prototype.afterGuiAttached = function () {\n        var selectedIndex = this.params.values.indexOf(this.selectedValue);\n        // we have to call this here to get the list to have the right height, ie\n        // otherwise it would not have scrolls yet and ensureIndexVisible would do nothing\n        this.virtualList.refresh();\n        if (selectedIndex >= 0) {\n            this.virtualList.ensureIndexVisible(selectedIndex);\n        }\n        // we call refresh again, as the list could of moved, and we need to render the new rows\n        this.virtualList.refresh();\n        if (this.focusAfterAttached) {\n            this.getGui().focus();\n        }\n    };\n    RichSelectCellEditor.prototype.getValue = function () {\n        // NOTE: we don't use valueParser for Set Filter. The user should provide values that are to be\n        // set into the data. valueParser only really makese sense when the user is typing in text (not picking\n        // form a set).\n        return this.selectionConfirmed ? this.selectedValue : this.originalSelectedValue;\n    };\n    // tab index is needed so we can focus, which is needed for keyboard events\n    RichSelectCellEditor.TEMPLATE = \"<div class=\\\"ag-rich-select\\\" tabindex=\\\"-1\\\">\\n            <div ref=\\\"eValue\\\" class=\\\"ag-rich-select-value\\\"></div>\\n            <div ref=\\\"eList\\\" class=\\\"ag-rich-select-list\\\"></div>\\n        </div>\";\n    __decorate([\n        Autowired('userComponentFactory')\n    ], RichSelectCellEditor.prototype, \"userComponentFactory\", void 0);\n    __decorate([\n        Autowired('gridOptionsWrapper')\n    ], RichSelectCellEditor.prototype, \"gridOptionsWrapper\", void 0);\n    __decorate([\n        RefSelector('eValue')\n    ], RichSelectCellEditor.prototype, \"eValue\", void 0);\n    __decorate([\n        RefSelector('eList')\n    ], RichSelectCellEditor.prototype, \"eList\", void 0);\n    return RichSelectCellEditor;\n}(PopupComponent));\nexport { RichSelectCellEditor };\n"]},"metadata":{},"sourceType":"module"}